import{B as Q,v as W,k as z,f as V,a as t,w as S,o as x,b as u,t as D,u as s,g as w,au as C,d as L,n as E,D as aa,e as ea}from"./app-1163a5a6.js";import{_ as ra,a as la}from"./SecondaryButton-1c05a758.js";import{_ as j}from"./InputError-a6fa3c9e.js";import{_ as b,a as h}from"./TextInput-e3d3e8ef.js";import{_ as sa}from"./PrimaryButton-4edf888a.js";import{_ as na}from"./SelectInput-80e572af.js";import{Z as O}from"./main-e5fab067.js";import{a as oa}from"./app-57141eb6.js";const ta={class:"space-y-6"},ia=["onSubmit"],da={class:"flex space-x-4"},ua={class:"text-lg font-medium text-gray-900 dark:text-gray-100"},ca={class:"text-md font-medium text-gray-900 dark:text-gray-100"},ma={class:"text-md font-medium text-gray-900 dark:text-gray-100"},_a={class:"my-6 grid grid-cols-1 md:grid-cols-2 gap-6"},fa={class:"mt-4 grid grid-cols-2 gap-6"},ga={key:0,class:"mt-4 grid grid-cols-2 gap-6"},ba={key:1,class:"grid grid-cols-2 gap-6"},ha={key:2,class:"grid grid-cols-2 gap-6"},pa={class:"mt-4"},ya={key:3,class:"mt-4"},va=u("label",{class:"dark:text-white"},"Horario",-1),Da={class:"flex justify-end"},Va={key:0,class:"m-2"},Ia={__name:"Create",props:{show:Boolean,title:String,valoresSelect:Object,IntegerDefectoSelect:Number,horasemana:Number,startDateMostrar:String,endDateMostrar:String,numberPermissions:Number,ultimoReporte:Number},emits:["close"],setup(q,{emit:k}){const m=q;let K=new Date().getFullYear(),P=oa.getHolidaysByYear(K),F=Q(null);const I=48,N=22,U=9-m.ultimoReporte;let T=0;const a=W({fecha_ini:"",fecha_fin:"",horas_trabajadas:"",centro_costo_id:m.IntegerDefectoSelect,observaciones:"",almuerzo:"0",diurnas:0,nocturnas:0,extra_diurnas:0,extra_nocturnas:0,dominicales:"no",extra:"no",esFestivo:!1,dominical_diurnas:0,dominical_nocturnas:0,dominical_extra_diurnas:0,dominical_extra_nocturnas:0});m.numberPermissions>8&&(a.fecha_ini="2023-10-31T07:00",a.fecha_fin="2023-10-31T16:00");function B(l){let r,e,o,n,d=!1;var p={};let f=Math.floor(l.getDate()),i=l.getMonth();try{P.forEach(c=>{if(e=c.date.split("/"),r=new Date(e[2],e[1]-1,e[0]),o=Math.floor(r.getDate()),n=r.getMonth(),o===f&&n===i)throw d=!0,p})}catch{}return d}let y="",_,g;const Y=()=>{let l=Date.parse(a.fecha_fin),r=new Date(l);const e=r.getHours(),o=r.getMinutes();e==23&&o==59&&(a.horas_trabajadas++,a.nocturnas++)},H=()=>{a.fecha_fin,Y(),a.horas_trabajadas<=N&&a.horas_trabajadas!=0?Object.keys(a.errors).length===0?(a.almuerzo=T,a.post(route("Reportes.store"),{preserveScroll:!0,onSuccess:()=>{k("close"),a.reset()},onError:()=>{},onFinish:()=>k("close")})):alert("Verifique de nuevo"):alert("Horas invalidas")};function Z(l,r,e){a.dominical_diurnas=a.diurnas,a.dominical_extra_diurnas=a.extra_diurnas;const o=parseInt(l.getHours());if(o<=6)a.diurnas=0,a.extra_diurnas=0,a.nocturnas==0?(a.dominical_nocturnas=a.nocturnas-o,a.nocturnas=o):(a.dominical_extra_nocturnas=a.extra_nocturnas-o,a.extra_nocturnas=o);else{a.nocturnas==0?(a.dominical_extra_nocturnas=g,a.extra_nocturnas=_):(a.dominical_nocturnas=g,a.nocturnas=_-a.extra_nocturnas);const n=Math.abs(o-6);a.diurnas==0?(a.dominical_extra_diurnas=a.extra_diurnas-n,a.extra_diurnas=n):(a.dominical_diurnas=a.diurnas-n,a.diurnas=n)}}function J(l,r,e,o){const n=parseInt(l.getHours()),d=parseInt(r.getHours());e!==null?e<6?(a.dominical_extra_nocturnas=_-e,a.extra_nocturnas-=a.dominical_extra_nocturnas,a.dominical_nocturnas=e,a.nocturnas-=e,a.dominical_diurnas=0,a.dominical_extra_diurnas=d>6?d-6:0,a.extra_diurnas-=a.dominical_extra_diurnas):o?(a.dominical_nocturnas=_,a.nocturnas=g,a.dominical_diurnas=e-6,a.dominical_extra_diurnas=d-e,a.diurnas=0,a.extra_diurnas=0):(a.dominical_extra_nocturnas=_,a.extra_nocturnas-=_,a.dominical_nocturnas=0,a.dominical_diurnas=0,d>6&&(a.dominical_extra_diurnas=d-6,a.extra_diurnas-=a.dominical_extra_diurnas)):(a.dominical_nocturnas=_,a.nocturnas-=_,n>=21?(a.dominical_diurnas=parseInt(a.diurnas),a.diurnas=0):(a.diurnas=21-n,a.dominical_diurnas=d>6?d-6:0))}function X(l,r,e,o){let n=B(new Date(l)),d=B(new Date(r));l.getDay()==0||r.getDay()==0?(a.dominicales="si",y="Dominical",(n||d)&&(y=" y festivo")):n||d?(a.dominicales="si",y="Festivo"):a.dominicales="no",l.getDay()==0&&r.getDay()==0||n||d?(a.dominical_diurnas=a.diurnas,a.diurnas=0,a.dominical_nocturnas=a.nocturnas,a.nocturnas=0,a.dominical_extra_diurnas=a.extra_diurnas,a.extra_diurnas=0,a.dominical_extra_nocturnas=a.extra_nocturnas,a.extra_nocturnas=0):((l.getDay()==0||n)&&Z(r),(r.getDay()==0||d)&&J(l,r,e,o)),a.horas_trabajadas>=U&&(a.horas_trabajadas-=1,a.diurnas>0&&a.nocturnas<=a.diurnas?(a.diurnas-=1,a.almuerzo+=" diurno"):a.nocturnas>0&&a.nocturnas>a.diurnas&&(a.nocturnas-=1,a.almuerzo+=" nocturno"))}function G(l,r){let e=new Date(l),o=new Date(r),n=null,d=!1;if(a.horas_trabajadas<U)a.almuerzo="No",a.diurnas=Math.abs(R(a.fecha_ini,a.fecha_fin,n)[1]),a.nocturnas=Math.abs($(a.fecha_ini,a.fecha_fin,n)[1]);else{let p=0;p+=m.ultimoReporte,a.almuerzo=a.horas_trabajadas+p>8?1:0,a.almuerzo=a.horas_trabajadas+p>16?2:a.almuerzo,T=a.almuerzo,a.almuerzo+=" horas";let f=9;m.horasemana>I-9&&(f=m.horasemana-I),n=parseInt(new Date(a.fecha_ini).getHours())+f,n>=24&&(n=24,d=!0);let i=R(a.fecha_ini,a.fecha_fin,n);a.extra_diurnas=i[0],a.diurnas=i[1];let c=$(a.fecha_ini,a.fecha_fin,n);a.extra_nocturnas=c[0],a.nocturnas=c[1]}X(e,o,n,d)}function R(l,r,e){const o=new Date(l).getHours(),n=new Date(r).getHours(),d=new Date(l).getDate(),p=new Date(r).getDate();let f=o>=6?o:6;if(d==p){let i=0,v=(n>=21?21:n)-f;if(v=v<0?0:v,e!==null&&e<21){let M=e-f;v>=M&&(i=v-M,v=M)}return[i,v]}else{let i=0,c=0;return n<=6?(i=f<=21?21-f:0,e!==null&&e<21&&e>6&&(f<=e,i=e-f,c=21-e)):(o<=21?i=21-o:e!==null?i=e-6:i=o==23?1:0,e!==null&&(e<=6?c=n>6?n-6:0:n>=e?c=n-e:(c=e<=21?21-e:0,c+=n>=6?n-6:0))),[c,i]}}function $(l,r,e){const o=new Date(l).getHours(),n=new Date(r).getHours(),d=new Date(l).getDate(),p=new Date(r).getDate();_=0,g=0,d==p?(o<6&&n<=6?_=n-o:o<6&&(_=6-o),o>=21&&n>=21?g=n-o:n>21&&(g=n-21)):(o<6&&n<=6&&o<n?_=n-o:(o<6&&(_=6-o),n<=6?_+=n:_+=6),o>=21&&n>=21?g=n-o:(n>21&&(g+=n-21),o>21?g+=24-o:g+=24-21));let f=_+g,i=0,c=0;return e===null||typeof e>"u"?[0,f]:(e>=21?n>=21?(i=n>=e?n-e:0,c=f-i):(i=24-e,i+=_,c=f-i):e<=6?(c=e+g,i=_>=e?_-e:0):n>21?(i=g,c=_):d==p?(i=0,c=f):(c=o<6?6-o:0,i=f-c),[i,c])}z(()=>{if(m.show&&(a.errors={},Date.parse(a.fecha_ini)&&Date.parse(a.fecha_fin))){let l=Date.parse(a.fecha_ini),r=Date.parse(a.fecha_fin);if(a.horas_trabajadas=0,a.almuerzo=0,a.diurnas=0,a.nocturnas=0,a.extra_diurnas=0,a.extra_nocturnas=0,a.dominical_diurnas=0,a.dominical_nocturnas=0,a.dominical_extra_diurnas=0,a.dominical_extra_nocturnas=0,a.horas_trabajadas=parseInt((r-l)/(3600*1e3)),l>r)a.errors.horas_trabajadas="La fecha inicial no debe ser posterior a la final";else if(a.horas_trabajadas>=N)a.errors.horas_trabajadas="Las horas trabajadas son demasiadas",a.horas_trabajadas="0",a.diurnas="0",a.nocturnas="0",a.almuerzo="0";else{const e=new Date(l).getDate(),o=new Date(r).getDate();e!=o?(a.errors.horas_trabajadas="Debe realizar dos reportes",a.horas_trabajadas="0",a.diurnas="0",a.nocturnas="0",a.almuerzo="0"):G(l,r)}}});const A=["Lun","Mar","Mie","Jue","Vie","Sab","Dom"];return(l,r)=>(x(),V("section",ta,[t(ra,{show:m.show,onClose:r[15]||(r[15]=e=>k("close"))},{default:S(()=>[u("form",{class:"p-6",onSubmit:ea(H,["prevent"])},[u("div",da,[u("h2",ua,[u("b",null,D(m.title),1)]),u("h2",ca," Horas semana: "+D(m==null?void 0:m.horasemana),1),u("h2",ma,D(m==null?void 0:m.startDateMostrar)+" - "+D(m==null?void 0:m.endDateMostrar),1)]),u("div",_a,[u("div",null,[t(b,{for:"fecha_ini",value:l.lang().label.fecha_ini},null,8,["value"]),t(s(O),{"is-24":!1,"day-names":A,"auto-apply":"",flow:["calendar","time"],"enable-time-picker":!0,teleport:!0,id:"fecha_ini",type:"date",class:"mt-1 block w-full",modelValue:s(a).fecha_ini,"onUpdate:modelValue":r[0]||(r[0]=e=>s(a).fecha_ini=e),required:"",placeholder:l.lang().placeholder.fecha_ini,error:s(a).errors.fecha_ini},null,8,["modelValue","placeholder","error"]),t(j,{class:"mt-2",message:s(a).errors.fecha_ini},null,8,["message"])]),u("div",null,[t(b,{for:"fecha_fin",value:l.lang().label.fecha_fin},null,8,["value"]),t(s(O),{"is-24":!1,"day-names":A,"auto-apply":"",flow:["calendar","time"],"enable-time-picker":!0,teleport:!0,id:"fecha_fin",type:"date",class:"mt-1 block w-full",modelValue:s(a).fecha_fin,"onUpdate:modelValue":r[1]||(r[1]=e=>s(a).fecha_fin=e),required:"",placeholder:l.lang().placeholder.fecha_fin,error:s(a).errors.fecha_fin},null,8,["modelValue","placeholder","error"]),t(j,{class:"mt-2",message:s(a).errors.fecha_fin},null,8,["message"])]),u("div",null,[t(b,{for:"horas_trabajadas",value:l.lang().label.horas_trabajadas},null,8,["value"]),t(h,{id:"horas_trabajadas",type:"number",class:"bg-gray-100 dark:bg-gray-700 mt-1 block w-full",modelValue:s(a).horas_trabajadas,"onUpdate:modelValue":r[2]||(r[2]=e=>s(a).horas_trabajadas=e),disabled:"",placeholder:l.lang().placeholder.horas_trabajadas,error:s(a).errors.horas_trabajadas},null,8,["modelValue","placeholder","error"]),t(j,{class:"bg-gray-100 dark:bg-gray-700 mt-2",message:s(a).errors.horas_trabajadas},null,8,["message"])]),u("div",null,[t(b,{for:"almuerzo",value:l.lang().label.horacomida+" (+9 horas)"},null,8,["value"]),t(h,{id:"almuerzo",type:"text",class:"bg-gray-100 dark:bg-gray-700 mt-1 w-full",modelValue:s(a).almuerzo,"onUpdate:modelValue":r[3]||(r[3]=e=>s(a).almuerzo=e),disabled:"",placeholder:l.lang().placeholder.almuerzo,error:s(a).errors.almuerzo},null,8,["modelValue","placeholder","error"])]),u("div",fa,[u("div",null,[t(b,{ref_key:"label_diurnas",ref:F,for:"diurnas",value:l.lang().label.diurnas},null,8,["value"]),t(h,{id:"diurnas",type:"number",class:"bg-gray-100 dark:bg-gray-700 mt-1 w-full",modelValue:s(a).diurnas,"onUpdate:modelValue":r[4]||(r[4]=e=>s(a).diurnas=e),disabled:"",placeholder:l.lang().placeholder.diurnas,error:s(a).errors.diurnas},null,8,["modelValue","placeholder","error"])]),u("div",null,[t(b,{ref:"label_nocturnas",for:"nocturnas",value:l.lang().label.nocturnas},null,8,["value"]),t(h,{id:"nocturnas",type:"number",class:"bg-gray-100 dark:bg-gray-700 mt-1 w-full",modelValue:s(a).nocturnas,"onUpdate:modelValue":r[5]||(r[5]=e=>s(a).nocturnas=e),disabled:"",placeholder:l.lang().placeholder.nocturnas,error:s(a).errors.nocturnas},null,8,["modelValue","placeholder","error"])])]),s(a).extra_diurnas||s(a).extra_nocturnas||s(a).dominicales=="si"?(x(),V("div",ga,[u("div",null,[t(b,{ref:"label_extra_diurnas",for:"extra_diurnas",value:l.lang().label.extra_diurnas},null,8,["value"]),t(h,{id:"extra_diurnas",type:"number",class:"bg-gray-100 dark:bg-gray-700 mt-1 w-full",modelValue:s(a).extra_diurnas,"onUpdate:modelValue":r[6]||(r[6]=e=>s(a).extra_diurnas=e),disabled:"",placeholder:l.lang().placeholder.extra_diurnas,error:s(a).errors.extra_diurnas},null,8,["modelValue","placeholder","error"])]),u("div",null,[t(b,{ref:"label_extra_nocturnas",for:"extra_nocturnas",value:l.lang().label.extra_nocturnas},null,8,["value"]),t(h,{id:"extra_nocturnas",type:"number",class:"bg-gray-100 dark:bg-gray-700 mt-1 w-full",modelValue:s(a).extra_nocturnas,"onUpdate:modelValue":r[7]||(r[7]=e=>s(a).extra_nocturnas=e),disabled:"",placeholder:l.lang().placeholder.extra_nocturnas,error:s(a).errors.extra_nocturnas},null,8,["modelValue","placeholder","error"])])])):w("",!0),s(a).dominicales=="si"?(x(),V("div",ba,[u("div",null,[t(b,{ref_key:"label_diurnas",ref:F,for:"dominical_diurnas",value:l.lang().label.dominical_diurnas},null,8,["value"]),t(h,{id:"dominical_diurnas",type:"number",class:"bg-gray-100 dark:bg-gray-700 mt-1 w-full",modelValue:s(a).dominical_diurnas,"onUpdate:modelValue":r[8]||(r[8]=e=>s(a).dominical_diurnas=e),disabled:"",placeholder:l.lang().placeholder.dominical_diurnas,error:s(a).errors.dominical_diurnas},null,8,["modelValue","placeholder","error"])]),u("div",null,[t(b,{ref:"label_nocturnas",for:"dominical_nocturnas",value:l.lang().label.dominical_nocturnas},null,8,["value"]),t(h,{id:"dominical_nocturnas",type:"number",class:"bg-gray-100 dark:bg-gray-700 mt-1 w-full",modelValue:s(a).dominical_nocturnas,"onUpdate:modelValue":r[9]||(r[9]=e=>s(a).dominical_nocturnas=e),disabled:"",placeholder:l.lang().placeholder.dominical_nocturnas,error:s(a).errors.dominical_nocturnas},null,8,["modelValue","placeholder","error"])])])):w("",!0),s(a).dominicales=="si"?(x(),V("div",ha,[u("div",null,[t(b,{ref:"label_extra_diurnas",for:"dominical_extra_diurnas",value:l.lang().label.dominical_extra_diurnas},null,8,["value"]),t(h,{id:"dominical_extra_diurnas",type:"number",class:"bg-gray-100 dark:bg-gray-700 mt-1 w-full",modelValue:s(a).dominical_extra_diurnas,"onUpdate:modelValue":r[10]||(r[10]=e=>s(a).dominical_extra_diurnas=e),disabled:"",placeholder:l.lang().placeholder.dominical_extra_diurnas,error:s(a).errors.dominical_extra_diurnas},null,8,["modelValue","placeholder","error"])]),u("div",null,[t(b,{ref:"label_extra_nocturnas",for:"dominical_extra_nocturnas",value:l.lang().label.dominical_extra_nocturnas},null,8,["value"]),t(h,{id:"dominical_extra_nocturnas",type:"number",class:"bg-gray-100 dark:bg-gray-700 mt-1 w-full",modelValue:s(a).dominical_extra_nocturnas,"onUpdate:modelValue":r[11]||(r[11]=e=>s(a).dominical_extra_nocturnas=e),disabled:"",placeholder:l.lang().placeholder.dominical_extra_nocturnas,error:s(a).errors.dominical_extra_nocturnas},null,8,["modelValue","placeholder","error"])])])):w("",!0),u("div",pa,[t(b,{for:"centro_costo_id",value:l.lang().label.centro_costo_id},null,8,["value"]),t(na,{modelValue:s(a).centro_costo_id,"onUpdate:modelValue":r[12]||(r[12]=e=>s(a).centro_costo_id=e),dataSet:m.valoresSelect,class:"mt-1 block w-full"},null,8,["modelValue","dataSet"]),t(j,{class:"mt-2",message:s(a).errors.centro_costo_id},null,8,["message"])]),s(a).dominicales=="si"?(x(),V("div",ya,[va,t(h,{id:"dominicales",type:"text",class:"bg-gray-100 dark:bg-gray-700 block w-full",modelValue:s(y),"onUpdate:modelValue":r[13]||(r[13]=e=>C(y)?y.value=e:y=e),disabled:""},null,8,["modelValue"])])):w("",!0)]),u("div",Da,[m.ultimoReporte>0?(x(),V("p",Va,"Hay pendientes "+D(m.ultimoReporte)+" horas",1)):w("",!0),t(la,{disabled:s(a).processing,onClick:r[14]||(r[14]=e=>k("close"))},{default:S(()=>[L(D(l.lang().button.close),1)]),_:1},8,["disabled"]),t(sa,{class:E(["ml-3",{"opacity-25":s(a).processing}]),disabled:s(a).processing,onClick:H,onKeyup:aa(H,["enter"])},{default:S(()=>[L(D(s(a).processing?l.lang().button.add+"...":l.lang().button.add),1)]),_:1},8,["class","disabled","onKeyup"])])],40,ia)]),_:1},8,["show"])]))}};export{Ia as default};
