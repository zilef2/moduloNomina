import{k as E,p as aa,T as ea,m as ra,f as V,a as t,w as j,o as D,b as m,d as H,t as w,u as l,g as U,G as la,y as sa,a8 as oa,c as $,n as L,e as na}from"./app-de7a70b3.js";import{_ as ia,a as ta}from"./SecondaryButton-95df27fa.js";import{_ as k}from"./InputError-0eb3fae4.js";import{_ as b}from"./InputLabel-2cec5dbc.js";import{_ as O}from"./PrimaryButton-a4148a76.js";import{_ as p}from"./TextInput-ac2cc8a7.js";import{_ as da}from"./SelectInput-4641c978.js";import{X as P}from"./main-75f60039.js";import{a as ua}from"./app-57141eb6.js";import{T as X}from"./global-683f42af.js";const ca={class:"space-y-6"},ma={class:"text-lg font-medium text-gray-900 dark:text-gray-100"},_a={class:"my-6 grid grid-cols-1 md:grid-cols-2 gap-6"},fa={class:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-6"},ga={key:0,class:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-6"},ba={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ha={key:2,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},pa={class:"mt-4"},va={key:3,class:""},ya=m("label",{class:"dark:text-white"},"Horario",-1),Da={class:"my-6"},xa=["disabled","error"],wa={class:"flex justify-end"},Y=48,Va=22,q=9,Ba={__name:"Edit",props:{show:Boolean,title:String,Reporte:Object,valoresSelect:Object,showUsers:Object,correccionUsuario:Boolean},emits:["close"],setup(M,{emit:G}){let J=new Date().getFullYear(),K=ua.getHolidaysByYear(J),R=E(null),y="",_,g,T=0;const f=M,F=G;aa({horas_trabajadas:"",almuerzo:"0",diurnas:0,nocturnas:0,extra_diurnas:0,extra_nocturnas:0,dominicales:"no",extra:"no",esFestivo:!1,dominical_diurnas:0,dominical_nocturnas:0,dominical_extra_diurnas:0,dominical_extra_nocturnas:0});const a=ea({fecha_ini:"",fecha_fin:"",horas_trabajadas:"",centro_costo_id:"",observaciones:"",almuerzo:"",valido:"",diurnas:0,nocturnas:0,extra_diurnas:0,extra_nocturnas:0,dominicales:"no",extra:"no",esFestivo:!1,dominical_diurnas:0,dominical_nocturnas:0,dominical_extra_diurnas:0,dominical_extra_nocturnas:0}),I=()=>{var s;a.almuerzo=T,f.correccionUsuario?a.valido=0:a.valido=2,a.horas_trabajadas<=48?a.put(route("Reportes.update",(s=f.Reporte)==null?void 0:s.id),{preserveScroll:!0,onSuccess:()=>{F("close"),a.reset()},onError:()=>null,onFinish:()=>null}):alert("Demasiadas horas")};function S(s){let r,e,n,o,u=!1;var h={};let c=Math.floor(s.getDate()),i=s.getMonth();try{K.forEach(d=>{if(e=d.date.split("/"),r=new Date(e[2],e[1]-1,e[0]),n=Math.floor(r.getDate()),o=r.getMonth(),n===c&&o===i)throw u=!0,h})}catch{}return u}function Q(s,r,e){a.dominical_diurnas=a.diurnas,a.dominical_extra_diurnas=a.extra_diurnas;const n=parseInt(s.getHours());if(n<=6)a.diurnas=0,a.extra_diurnas=0,a.nocturnas==0?(a.dominical_nocturnas=a.nocturnas-n,a.nocturnas=n):(a.dominical_extra_nocturnas=a.extra_nocturnas-n,a.extra_nocturnas=n);else{a.nocturnas==0?(a.dominical_extra_nocturnas=g,a.extra_nocturnas=_):(a.dominical_nocturnas=g,a.nocturnas=_-a.extra_nocturnas);const o=Math.abs(n-6);a.diurnas==0?(a.dominical_extra_diurnas=a.extra_diurnas-o,a.extra_diurnas=o):(a.dominical_diurnas=a.diurnas-o,a.diurnas=o)}}function W(s,r,e,n){const o=parseInt(s.getHours()),u=parseInt(r.getHours());e!==null?e<6?(a.dominical_extra_nocturnas=_-e,a.extra_nocturnas-=a.dominical_extra_nocturnas,a.dominical_nocturnas=e,a.nocturnas-=e,a.dominical_diurnas=0,a.dominical_extra_diurnas=u>6?u-6:0,a.extra_diurnas-=a.dominical_extra_diurnas,console.log("camino1")):n?(a.dominical_nocturnas=_,a.nocturnas=g,a.dominical_diurnas=e-6,a.dominical_extra_diurnas=u-e,a.diurnas=0,a.extra_diurnas=0,console.log("camino2")):(a.dominical_extra_nocturnas=_,a.extra_nocturnas-=_,a.dominical_nocturnas=0,a.dominical_diurnas=0,console.log("camino3"),u>6&&(a.dominical_extra_diurnas=u-6,a.extra_diurnas-=a.dominical_extra_diurnas)):(a.dominical_nocturnas=_,a.nocturnas-=_,o>=21?(a.dominical_diurnas=parseInt(a.diurnas),a.diurnas=0):(a.diurnas=21-o,a.dominical_diurnas=u>6?u-6:0),console.log("camino4 sin extras"))}function Z(s,r,e,n){let o=S(new Date(s)),u=S(new Date(r));console.log("ini festivo - fin festivo :",o,u),s.getDay()==0||r.getDay()==0?(a.dominicales="si",y="Dominical",(o||u)&&(y=" y festivo")):o||u?(a.dominicales="si",y="Festivo"):a.dominicales="no",s.getDay()==0&&r.getDay()==0||o||u?(a.dominical_diurnas=a.diurnas,a.diurnas=0,a.dominical_nocturnas=a.nocturnas,a.nocturnas=0,a.dominical_extra_diurnas=a.extra_diurnas,a.extra_diurnas=0,a.dominical_extra_nocturnas=a.extra_nocturnas,a.extra_nocturnas=0):((s.getDay()==0||o)&&Q(r),(r.getDay()==0||u)&&W(s,r,e,n)),a.horas_trabajadas>=q&&(a.horas_trabajadas-=1,a.diurnas>0&&a.nocturnas<=a.diurnas?(a.diurnas-=1,a.almuerzo+=" diurno"):a.nocturnas>0&&a.nocturnas>a.diurnas&&(a.nocturnas-=1,a.almuerzo+=" nocturno")),console.log("Fin!")}function z(s,r){let e=new Date(s),n=new Date(r),o=null,u=!1;if(a.horas_trabajadas<q)a.almuerzo="No",a.diurnas=Math.abs(B(a.fecha_ini,a.fecha_fin,o)[1]),a.nocturnas=Math.abs(N(a.fecha_ini,a.fecha_fin,o)[1]);else{console.log("extras"),a.almuerzo=a.horas_trabajadas>8?1:0,a.almuerzo=a.horas_trabajadas>16?2:a.almuerzo,T=a.almuerzo,a.almuerzo+=" horas";let h=9;f.horasemana>Y-9&&(h=f.horasemana-Y,console.log("ğŸ§ˆ debu ExtrasPrematuras:",h)),o=parseInt(new Date(a.fecha_ini).getHours())+h,o>=24&&(o=24,u=!0);let c=B(a.fecha_ini,a.fecha_fin,o);a.extra_diurnas=c[0],a.diurnas=c[1];let i=N(a.fecha_ini,a.fecha_fin,o);a.extra_nocturnas=i[0],a.nocturnas=i[1]}console.log("ğŸ§ˆ ğŸ§ˆ  CuandoEmpiezaExtra:",o),Z(e,n,o,u)}function B(s,r,e){const n=new Date(s).getHours(),o=new Date(r).getHours(),u=new Date(s).getDate(),h=new Date(r).getDate();let c=n>=6?n:6;if(u==h){let i=0,v=(o>=21?21:o)-c;if(v=v<0?0:v,e!==null&&e<21){let x=e-c;x=x<0?0:x,v>=x?(i=v-x,v=x):console.log("imposible!")}return console.log("mismo DIA, HorasExtra & ordinarias",i,v),[i,v]}else{let i=0,d=0;return o<=6?(i=c<=21?21-c:0,e!==null&&e<21&&e>6&&(c<=e,i=e-c,d=21-e)):(n<=21?i=21-n:e!==null?i=e-6:i=n==23?1:0,e!==null&&(e<=6?d=o>6?o-6:0:o>=e?d=o-e:(d=e<=21?21-e:0,d+=o>=6?o-6:0))),console.log("ğŸ§ˆğŸ§ˆğŸ§ˆ DIA HorasExtra & ordinarias",d,i),[d,i]}}function N(s,r,e){const n=new Date(s).getHours(),o=new Date(r).getHours(),u=new Date(s).getDate(),h=new Date(r).getDate();_=0,g=0,u==h?(n<6&&o<=6?_=o-n:n<6&&(_=6-n),n>=21&&o>=21?g=o-n:o>21&&(g=o-21)):(n<6&&o<=6&&n<o?_=o-n:(n<6&&(_=6-n),o<=6?_+=o:_+=6),n>=21&&o>=21?g=o-n:(o>21&&(g+=o-21),n>21?g+=24-n:g+=24-21));let c=_+g;console.log("ğŸš€ Madrugada & tarde:",_,g+" = "+c);let i=0,d=0;return e===null||typeof e>"u"?[0,c]:(e>=21?o>=21?(i=o>=e?o-e:0,d=c-i,console.log("0a : extra & noche",i,d)):(i=24-e,i+=_,d=c-i,console.log("0a : extra & noche",i,d)):e<=6?(d=e+g,i=_>=e?_-e:0,console.log("ğŸš€ 1 : extra & noche",i,d)):o>21?(i=g,d=_,console.log("ğŸ˜¶â€ğŸŒ«ï¸2  extra  ordinarias",i,d)):u==h?(i=0,d=c,console.log("ğŸ˜¶â€ğŸŒ«ï¸1  extra  ordinarias",i,d)):(d=n<6?6-n:0,i=c-d,console.log("ğŸ˜¶â€ğŸŒ«ï¸0  extra  ordinarias",i,d)),[i,d])}const C=()=>{let s=Date.parse(a.fecha_fin),r=new Date(s);const e=r.getHours(),n=r.getMinutes();e==23&&n==59&&(a.horas_trabajadas++,a.nocturnas++)};ra(()=>{var s,r,e,n,o,u,h;if(f.show&&(a.errors={},a.fecha_ini==""&&(a.fecha_ini=X((s=f.Reporte)==null?void 0:s.fecha_ini)),a.fecha_fin==""&&(a.fecha_fin=X((r=f.Reporte)==null?void 0:r.fecha_fin)),a.centro_costo_id=(e=f.Reporte)==null?void 0:e.centro_costo_id,a.fecha_ini=(n=f.Reporte)==null?void 0:n.fecha_ini,a.fecha_fin=(o=f.Reporte)==null?void 0:o.fecha_fin,a.observaciones=(u=f.Reporte)==null?void 0:u.observaciones,a.horas_trabajadas=(h=f.Reporte)==null?void 0:h.horas_trabajadas,C(),Date.parse(a.fecha_ini)>Date.parse(a.fecha_fin)?a.horas="0":a.horas_trabajadas=parseInt((Date.parse(a.fecha_fin)-Date.parse(a.fecha_ini))/(3600*1e3)),Date.parse(a.fecha_ini)&&Date.parse(a.fecha_fin))){let c=Date.parse(a.fecha_ini),i=Date.parse(a.fecha_fin);if(a.horas_trabajadas=0,a.almuerzo=0,a.diurnas=0,a.nocturnas=0,a.extra_diurnas=0,a.extra_nocturnas=0,a.dominical_diurnas=0,a.dominical_nocturnas=0,a.dominical_extra_diurnas=0,a.dominical_extra_nocturnas=0,a.horas_trabajadas=parseInt((i-c)/(3600*1e3)),c>i)a.errors.horas_trabajadas="La fecha inicial no debe ser posterior a la final";else if(a.horas_trabajadas>=Va)a.errors.horas_trabajadas="Las horas trabajadas son demasiadas",a.horas_trabajadas="0",a.diurnas="0",a.nocturnas="0",a.almuerzo="0";else{const d=new Date(c).getDate(),v=new Date(i).getDate();d!=v?(a.errors.horas_trabajadas="Debe realizar dos reportes",a.horas_trabajadas="0",a.diurnas="0",a.nocturnas="0",a.almuerzo="0"):z(c,i)}}});const A=["Lun","Mar","Mie","Jue","Vie","Sab","Dom"];return(s,r)=>(D(),V("section",ca,[t(ia,{show:f.show,onClose:r[16]||(r[16]=e=>F("close"))},{default:j(()=>[m("form",{class:"p-6",onSubmit:na(I,["prevent"])},[m("h2",ma,[H(w(s.lang().label.edit)+" "+w(f.title)+" ",1),m("b",null,w(f.showUsers[f.Reporte.user_id]),1)]),m("div",_a,[m("div",null,[t(b,{for:"fecha_ini",value:s.lang().label.fecha_ini},null,8,["value"]),t(l(P),{"is-24":!1,"day-names":A,"auto-apply":"",flow:["calendar","time"],"enable-time-picker":!0,teleport:!0,id:"fecha_ini",type:"date",class:"mt-1 block w-full",modelValue:l(a).fecha_ini,"onUpdate:modelValue":r[0]||(r[0]=e=>l(a).fecha_ini=e),disabled:"",placeholder:s.lang().placeholder.fecha_ini,error:l(a).errors.fecha_ini},null,8,["modelValue","placeholder","error"]),t(k,{class:"mt-2",message:l(a).errors.fecha_ini},null,8,["message"])]),m("div",null,[t(b,{for:"fecha_fin",value:s.lang().label.fecha_fin},null,8,["value"]),t(l(P),{"is-24":!1,"day-names":A,"auto-apply":"",flow:["calendar","time"],"enable-time-picker":!0,teleport:!0,id:"fecha_fin",type:"date",class:"mt-1 block w-full",modelValue:l(a).fecha_fin,"onUpdate:modelValue":r[1]||(r[1]=e=>l(a).fecha_fin=e),disabled:"",placeholder:s.lang().placeholder.fecha_fin,error:l(a).errors.fecha_fin},null,8,["modelValue","placeholder","error"]),t(k,{class:"mt-2",message:l(a).errors.fecha_fin},null,8,["message"])]),m("div",null,[t(b,{for:"horas_trabajadas",value:s.lang().label.horas_trabajadas},null,8,["value"]),t(p,{id:"horas_trabajadas",type:"number",class:"mt-1 block w-full bg-gray-100 dark:bg-gray-700",modelValue:l(a).horas_trabajadas,"onUpdate:modelValue":r[2]||(r[2]=e=>l(a).horas_trabajadas=e),disabled:"",placeholder:s.lang().placeholder.horas_trabajadas,error:l(a).errors.horas_trabajadas},null,8,["modelValue","placeholder","error"]),t(k,{class:"mt-2",message:l(a).errors.horas_trabajadas},null,8,["message"])]),m("div",null,[t(b,{for:"almuerzo",value:s.lang().label.horacomida+" (+9 horas)"},null,8,["value"]),t(p,{id:"almuerzo",type:"text",class:"bg-gray-100 dark:bg-gray-700 mt-1 w-full",modelValue:l(a).almuerzo,"onUpdate:modelValue":r[3]||(r[3]=e=>l(a).almuerzo=e),disabled:"",placeholder:s.lang().placeholder.almuerzo,error:l(a).errors.almuerzo},null,8,["modelValue","placeholder","error"])]),m("div",fa,[m("div",null,[t(b,{ref_key:"label_diurnas",ref:R,for:"diurnas",value:s.lang().label.diurnas},null,8,["value"]),t(p,{id:"diurnas",type:"number",class:"bg-gray-100 dark:bg-gray-700 mt-1 w-full",modelValue:l(a).diurnas,"onUpdate:modelValue":r[4]||(r[4]=e=>l(a).diurnas=e),disabled:"",placeholder:s.lang().placeholder.diurnas,error:l(a).errors.diurnas},null,8,["modelValue","placeholder","error"])]),m("div",null,[t(b,{ref:"label_nocturnas",for:"nocturnas",value:s.lang().label.nocturnas},null,8,["value"]),t(p,{id:"nocturnas",type:"number",class:"bg-gray-100 dark:bg-gray-700 mt-1 w-full",modelValue:l(a).nocturnas,"onUpdate:modelValue":r[5]||(r[5]=e=>l(a).nocturnas=e),disabled:"",placeholder:s.lang().placeholder.nocturnas,error:l(a).errors.nocturnas},null,8,["modelValue","placeholder","error"])])]),l(a).extra_diurnas||l(a).extra_nocturnas||l(a).dominicales=="si"?(D(),V("div",ga,[m("div",null,[t(b,{ref:"label_extra_diurnas",for:"extra_diurnas",value:s.lang().label.extra_diurnas},null,8,["value"]),t(p,{id:"extra_diurnas",type:"number",class:"bg-gray-100 dark:bg-gray-700 mt-1 w-full",modelValue:l(a).extra_diurnas,"onUpdate:modelValue":r[6]||(r[6]=e=>l(a).extra_diurnas=e),disabled:"",placeholder:s.lang().placeholder.extra_diurnas,error:l(a).errors.extra_diurnas},null,8,["modelValue","placeholder","error"])]),m("div",null,[t(b,{ref:"label_extra_nocturnas",for:"extra_nocturnas",value:s.lang().label.extra_nocturnas},null,8,["value"]),t(p,{id:"extra_nocturnas",type:"number",class:"bg-gray-100 dark:bg-gray-700 mt-1 w-full",modelValue:l(a).extra_nocturnas,"onUpdate:modelValue":r[7]||(r[7]=e=>l(a).extra_nocturnas=e),disabled:"",placeholder:s.lang().placeholder.extra_nocturnas,error:l(a).errors.extra_nocturnas},null,8,["modelValue","placeholder","error"])])])):U("",!0),l(a).dominicales=="si"?(D(),V("div",ba,[m("div",null,[t(b,{ref_key:"label_diurnas",ref:R,for:"dominical_diurnas",value:s.lang().label.dominical_diurnas},null,8,["value"]),t(p,{id:"dominical_diurnas",type:"number",class:"bg-gray-100 dark:bg-gray-700 mt-1 w-full",modelValue:l(a).dominical_diurnas,"onUpdate:modelValue":r[8]||(r[8]=e=>l(a).dominical_diurnas=e),disabled:"",placeholder:s.lang().placeholder.dominical_diurnas,error:l(a).errors.dominical_diurnas},null,8,["modelValue","placeholder","error"])]),m("div",null,[t(b,{ref:"label_nocturnas",for:"dominical_nocturnas",value:s.lang().label.dominical_nocturnas},null,8,["value"]),t(p,{id:"dominical_nocturnas",type:"number",class:"bg-gray-100 dark:bg-gray-700 mt-1 w-full",modelValue:l(a).dominical_nocturnas,"onUpdate:modelValue":r[9]||(r[9]=e=>l(a).dominical_nocturnas=e),disabled:"",placeholder:s.lang().placeholder.dominical_nocturnas,error:l(a).errors.dominical_nocturnas},null,8,["modelValue","placeholder","error"])])])):U("",!0),l(a).dominicales=="si"?(D(),V("div",ha,[m("div",null,[t(b,{ref:"label_extra_diurnas",for:"dominical_extra_diurnas",value:s.lang().label.dominical_extra_diurnas},null,8,["value"]),t(p,{id:"dominical_extra_diurnas",type:"number",class:"bg-gray-100 dark:bg-gray-700 mt-1 w-full",modelValue:l(a).dominical_extra_diurnas,"onUpdate:modelValue":r[10]||(r[10]=e=>l(a).dominical_extra_diurnas=e),disabled:"",placeholder:s.lang().placeholder.dominical_extra_diurnas,error:l(a).errors.dominical_extra_diurnas},null,8,["modelValue","placeholder","error"])]),m("div",null,[t(b,{ref:"label_extra_nocturnas",for:"dominical_extra_nocturnas",value:s.lang().label.dominical_extra_nocturnas},null,8,["value"]),t(p,{id:"dominical_extra_nocturnas",type:"number",class:"bg-gray-100 dark:bg-gray-700 mt-1 w-full",modelValue:l(a).dominical_extra_nocturnas,"onUpdate:modelValue":r[11]||(r[11]=e=>l(a).dominical_extra_nocturnas=e),disabled:"",placeholder:s.lang().placeholder.dominical_extra_nocturnas,error:l(a).errors.dominical_extra_nocturnas},null,8,["modelValue","placeholder","error"])])])):U("",!0),m("div",pa,[t(b,{for:"centro_costo_id",value:s.lang().label.centro_costo_id},null,8,["value"]),t(da,{modelValue:l(a).centro_costo_id,"onUpdate:modelValue":r[12]||(r[12]=e=>l(a).centro_costo_id=e),dataSet:f.valoresSelect,disabled:"",class:"mt-1 block w-full"},null,8,["modelValue","dataSet"]),t(k,{class:"mt-2",message:l(a).errors.centro_costo_id},null,8,["message"])]),l(a).dominicales=="si"?(D(),V("div",va,[ya,t(p,{id:"dominicales",type:"text",class:"bg-gray-100 dark:bg-gray-700 block w-full",modelValue:l(y),"onUpdate:modelValue":r[13]||(r[13]=e=>la(y)?y.value=e:y=e),disabled:""},null,8,["modelValue"])])):U("",!0)]),m("div",Da,[t(b,{for:"observaciones",value:s.lang().label.observaciones+" (Porque se esta rechazando)"},null,8,["value"]),sa(m("textarea",{disabled:M.correccionUsuario,id:"observaciones",type:"text","onUpdate:modelValue":r[14]||(r[14]=e=>l(a).observaciones=e),class:"mt-1 block w-full rounded-md shadow-sm dark:bg-black dark:text-white placeholder:text-gray-400 placeholder:dark:text-gray-400/50",cols:"30",rows:"3",error:l(a).errors.observaciones},`\r
                        `,8,xa),[[oa,l(a).observaciones]]),t(k,{class:"mt-2",message:l(a).errors.observaciones},null,8,["message"])]),m("div",wa,[t(ta,{disabled:l(a).processing,onClick:r[15]||(r[15]=e=>F("close"))},{default:j(()=>[H(w(s.lang().button.close),1)]),_:1},8,["disabled"]),M.correccionUsuario?(D(),$(O,{key:0,class:L(["ml-3",{"opacity-25":l(a).processing}]),disabled:l(a).processing,onClick:I},{default:j(()=>[H(w(l(a).processing?"...":s.lang().button.corect),1)]),_:1},8,["class","disabled"])):(D(),$(O,{key:1,class:L(["ml-3",{"opacity-25":l(a).processing}]),disabled:l(a).processing,onClick:I},{default:j(()=>[H(w(l(a).processing?s.lang().button.reject+"...":s.lang().button.reject),1)]),_:1},8,["class","disabled"]))])],32)]),_:1},8,["show"])]))}};export{Ba as default};
